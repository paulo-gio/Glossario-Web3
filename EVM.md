# EVM, Ethereum Virtual Machine (Máquina Virtual Ethereum)

>"*A Máquina Virtual Ethereum, ou Ethereum Virtual Machine (EVM) é um componente fundamental do ecossistema Ethereum que executa contratos inteligentes e processa transações. Ela é uma máquina virtual baseada em pilha que executa bytecode e permite que os desenvolvedores criem aplicativos descentralizados (dApps) e contratos inteligentes. A EVM é crucial para a segurança e a confiabilidade da plataforma, implementando um ambiente isolado (sandbox) para proteger a rede contra contratos maliciosos.*"

A Máquina Virtual Ethereum, ou Ethereum Virtual Machine (EVM) é um componente central do ecossistema Ethereum que desempenha um papel crucial na execução de contratos inteligentes e no processamento de transações. A EVM é a parte do protocolo Ethereum que manipula a lógica interna e a execução de estado. Todos os nós na rede Ethereum implementam a EVM e a usam para executar as mesmas instruções e alterações de estado.

A EVM foi concebida no whitepaper original da Ethereum, escrito por Vitalik Buterin em 2014. A ideia era expandir as possibilidades da tecnologia blockchain para além do processamento de transações monetárias simples - uma função central do Bitcoin. Com a EVM, os desenvolvedores podem criar e executar aplicativos descentralizados (dApps) e contratos inteligentes, que são programas que operam automaticamente de acordo com regras pré-definidas.

E graças à segurança e confiabilidade da EVM, a Ethereum tem servido como base para muitas outras aplicações populares, incluindo aplicações financeiras descentralizadas (DeFi) como exchanges descentralizadas (DEXs), protocolos de empréstimos e outras aplicações. O ecossistema DeFi deve grande parte de seu crescimento à capacidade da Ethereum de sustentar essas aplicações confiáveis e interoperáveis.

A EVM é uma máquina virtual baseada em pilha que executa bytecode. O bytecode é um tipo de linguagem de máquina que é extremamente difícil de entender para humanos, mas eficiente para máquinas. Os desenvolvedores escrevem contratos inteligentes em linguagens de alto nível, como Solidity ou Vyper, que são então compilados em bytecode para serem executados na EVM.

Uma característica fundamental da Ethereum Virtual Machine (EVM) é sua capacidade de isolamento. Isso significa que o código executado dentro da EVM é executado em um ambiente controlado, conhecido como "sandbox", no qual não há acesso aos recursos externos, como o ambiente da rede, o sistema de arquivos ou outros processos. Essa estrutura de sandbox é projetada para fornecer segurança, evitando que contratos inteligentes maliciosos ou com erros afetem negativamente o resto da rede Ethereum. Essa medida de isolamento é essencial para garantir a integridade e a confiabilidade da plataforma.

A EVM é descrita formalmente no "Yellow Paper" da Ethereum, que foi escrito pelo cientista de computação Dr. Gavin Wood. O Yellow Paper detalha a especificação técnica para a Ethereum, incluindo a descrição precisa de como a EVM deve operar. É um documento bastante complexo e técnico, destinado principalmente a desenvolvedores que estão construindo clientes Ethereum ou pesquisando a plataforma em um nível mais profundo.

Os contratos inteligentes na EVM são ativados por transações ou mensagens que são assinadas e enviadas por contas externas. Cada contrato inteligente tem um endereço na Ethereum, assim como as contas que mantêm Ether (ETH). Quando uma transação é enviada para um endereço de contrato, a EVM acorda e começa a executar o código do contrato.

Para proteger a rede contra ataques que visam sobrecarregar a máquina, cada operação que é executada na EVM custa uma certa quantidade de "gás". O gás é uma medida de esforço computacional e cada unidade de gás tem um preço em ETH, que é pago pela conta externa que enviou a transação. Se uma operação não tiver gás suficiente para ser concluída, ela será revertida, mas o gás ainda será cobrado.

A EVM desempenha um papel vital na atualização e manutenção do estado global da Ethereum, que é um registro de todas as informações conhecidas sobre a Ethereum em um ponto específico no tempo. Cada vez que um contrato é executado na EVM, o estado da Ethereum pode mudar.

Além disso, a EVM é uma máquina Turing-completa, o que significa que, em teoria, é capaz de executar qualquer algoritmo, desde que sejam fornecidos recursos suficientes. Isso torna a EVM uma plataforma muito poderosa para o desenvolvimento de dApps.

A EVM é frequentemente comparada a uma máquina de estado distribuída. Esta é uma descrição adequada, já que o estado da Ethereum é uma grande estrutura de dados que não apenas mantém todas as contas e saldos, mas também um estado de máquina que muda de bloco para bloco de acordo com um conjunto predefinido de regras. Essas regras específicas para mudar o estado de bloco para bloco são definidas pela EVM.

A EVM executa como uma máquina de pilha com uma profundidade de 1024 itens. Cada item é uma palavra de 256 bits, o que foi escolhido por sua facilidade de uso com a criptografia de 256 bits, como as assinaturas Keccak-256 ou secp256k1. Durante a execução, a EVM mantém uma memória transitória que não persiste entre as transações.

Os contratos contêm uma trie de armazenamento Merkle Patricia, associado à conta em questão e parte do estado global. O bytecode do contrato inteligente compilado é executado como uma série de opcodes EVM, que realizam operações de pilha padrão, como XOR, AND, ADD, SUB, entre outros. A EVM também implementa uma série de operações de pilha específicas da blockchain, como ADDRESS, BALANCE, BLOCKHASH, entre outras.

Em termos de implementação, a EVM teve várias revisões ao longo dos anos e existem várias implementações da EVM em diferentes linguagens de programação. As implementações de clientes de execução da Ethereum incluem uma implementação da EVM, além disso, existem várias implementações autônomas, incluindo Py-EVM em Python, evmone em C++, ethereumjs-vm em JavaScript e eEVM em C++.

O comportamento da EVM é formalmente descrito como uma função de transição de estado, que desempenha um papel fundamental no processamento das transações e na atualização do estado global da plataforma, garantindo a consistência e a confiabilidade da blockchain. Essa função recebe como entrada um estado válido antigo (S) e um conjunto de transações válidas (T), e a função de transição de estado da Ethereum Y(S, T) produz um novo estado de saída válido (S'). Esse novo estado servirá como ponto de partida para a execução de transações futuras.

Concluindo, a EVM é um componente crucial da arquitetura da Ethereum, que permite a execução segura e eficiente de contratos inteligentes, o desenvolvimento de dApps e a exploração de inúmeras possibilidades, como as do DeFi, bem como a criação de aplicativos disruptivos e eficazes. Sua capacidade de lidar com lógica complexa e manter o estado global da Ethereum impulsiona a inovação e a transformação dos sistemas tradicionais, tornando a Ethereum uma plataforma líder na indústria blockchain.